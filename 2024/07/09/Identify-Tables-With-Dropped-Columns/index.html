<!doctype html><html lang=en-us><head><script type=application/ld+json>{"@context":"http://schema.org","@type":"Website","@id":"https:\/\/claudioessilva.eu\/","author":{"@type":"Person","name":"Cláudio Silva","image":"https://claudioessilva.eu/img/avatar.jpg"},"name":"Cláudio Silva\u0027s Blog","description":"On my last article - What happens when we drop a column on a SQL Server table? Where\u0026rsquo;s my space? - I have shown what happens when we drop a column from a table.\nToday, we are going to check if we have a way to find tables with dropped columns.\nWhy? As we learnt, when we drop a column this is just a metadata operation and won’t clear the space that was being used.","url":"https:\/\/claudioessilva.eu\/2024\/07\/09\/Identify-Tables-With-Dropped-Columns\/","keywords":"[]"}</script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo 0.128.2 with theme Tranquilpeak 0.5.3-BETA"><meta name=author content="Cláudio Silva"><meta name=keywords content><meta name=description content="On my last article - What happens when we drop a column on a SQL Server table? Where&rsquo;s my space? - I have shown what happens when we drop a column from a table.
Today, we are going to check if we have a way to find tables with dropped columns.
Why? As we learnt, when we drop a column this is just a metadata operation and won’t clear the space that was being used."><meta property="og:description" content="On my last article - What happens when we drop a column on a SQL Server table? Where&rsquo;s my space? - I have shown what happens when we drop a column from a table.
Today, we are going to check if we have a way to find tables with dropped columns.
Why? As we learnt, when we drop a column this is just a metadata operation and won’t clear the space that was being used."><meta property="og:type" content="article"><meta property="og:title" content="Identify Tables With Dropped Columns"><meta name=twitter:title content="Identify Tables With Dropped Columns"><meta property="og:url" content="https://claudioessilva.eu/2024/07/09/Identify-Tables-With-Dropped-Columns/"><meta property="twitter:url" content="https://claudioessilva.eu/2024/07/09/Identify-Tables-With-Dropped-Columns/"><meta property="og:site_name" content="Cláudio Silva's Blog"><meta property="og:description" content="On my last article - What happens when we drop a column on a SQL Server table? Where&rsquo;s my space? - I have shown what happens when we drop a column from a table.
Today, we are going to check if we have a way to find tables with dropped columns.
Why? As we learnt, when we drop a column this is just a metadata operation and won’t clear the space that was being used."><meta name=twitter:description content="On my last article - What happens when we drop a column on a SQL Server table? Where&rsquo;s my space? - I have shown what happens when we drop a column from a table.
Today, we are going to check if we have a way to find tables with dropped columns.
Why? As we learnt, when we drop a column this is just a metadata operation and won’t clear the space that was being used."><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2024-07-09T10:00:00"><meta property="article:modified_time" content="2024-07-09T10:00:00"><meta property="article:tag" content="SQLServer"><meta property="article:tag" content="TSQL"><meta property="article:tag" content="DBA"><meta property="article:tag" content="Internals"><meta property="article:tag" content="DBCC PAGE"><meta property="article:tag" content="system_internals_partition_columns"><meta property="article:tag" content="drop columns"><meta property="article:tag" content="syndicated"><meta name=twitter:card content="summary"><meta name=twitter:site content="@claudioessilva"><meta name=twitter:creator content="@claudioessilva"><meta property="og:image" content="https://claudioessilva.eu/img/2024/0415/GetDroppedColumns_coverImage.png"><meta property="twitter:image" content="https://claudioessilva.eu/img/2024/0415/GetDroppedColumns_coverImage.png"><meta property="og:image" content="https://claudioessilva.eu/img/2024/0415/GetDroppedColumns_coverImage.png"><meta property="twitter:image" content="https://claudioessilva.eu/img/2024/0415/GetDroppedColumns_coverImage.png"><meta property="og:image" content="https://claudioessilva.eu/img/2024/0415/GetDroppedColumns_thumbnailImage.png"><meta property="twitter:image" content="https://claudioessilva.eu/img/2024/0415/GetDroppedColumns_thumbnailImage.png"><title>Identify Tables With Dropped Columns</title>
<link rel=icon href=https://claudioessilva.eu/img/favicon.jpg><link rel=canonical href=https://claudioessilva.eu/2024/07/09/Identify-Tables-With-Dropped-Columns/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://claudioessilva.eu/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css></head><body><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=/ aria-label="Go to homepage">Cláudio Silva's Blog</a></div><a class=header-right-picture href=/#about aria-label="Open the link: /#about"><img class=header-picture src=https://claudioessilva.eu/img/avatar.jpg alt="Author's picture"></a></header><nav id=sidebar data-behavior=4><div class=sidebar-container><div class=sidebar-profile><a href=/#about aria-label="Read more about the author"><img class=sidebar-profile-picture src=https://claudioessilva.eu/img/avatar.jpg alt="Author's picture"></a><h4 class=sidebar-profile-name>Cláudio Silva</h4><h5 class=sidebar-profile-bio>Data Platform Architect and PowerShell lover.</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/ title=Home><i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden=true></i>
<span class=sidebar-button-desc>Home</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/tags title=Tags><i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden=true></i>
<span class=sidebar-button-desc>Tags</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/#about title=About><i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden=true></i>
<span class=sidebar-button-desc>About</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/claudioessilva target=_blank rel=noopener title=GitHub><i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden=true></i>
<span class=sidebar-button-desc>GitHub</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://twitter.com/claudioessilva target=_blank rel=noopener title=Twitter><i class="sidebar-button-icon fab fa-lg fa-twitter" aria-hidden=true></i>
<span class=sidebar-button-desc>Twitter</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://www.linkedin.com/in/claudioessilva target=_blank rel=noopener title=LinkedIn><i class="sidebar-button-icon fab fa-lg fa-linkedin" aria-hidden=true></i>
<span class=sidebar-button-desc>LinkedIn</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/index.xml title=RSS><i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden=true></i>
<span class=sidebar-button-desc>RSS</span></a></li></ul></div><div class=sidebar-container><div style=color:#ebebeb;font-size:25px;text-align:center>dbatools book</div><div style=color:#ebebeb;font-size:15px>Now available! Buy it at manning.com - 50% off with code bldbatools50</div><a href="https://www.manning.com/books/learn-dbatools-in-a-month-of-lunches?utm_source=claudioessilva&utm_medium=affiliate&utm_campaign=affiliate&a_aid=claudioessilva" target=_blank><center><img src=https://images.manning.com/264/352/resize/book/0/998b76f-982a-4661-a020-5d94909f7ea5/LeMaire-HI.png height=300></center></a></div></nav><div class="post-header-cover
text-center" style=background-image:url(/img/2024/0415/GetDroppedColumns_coverImage.png);height:30% data-behavior=4></div><div id=main data-behavior=4 class="hasCover
hasCoverMetaOut"><article class=post id=top><div class="post-header main-content-wrap text-center"><h1 class=post-title>Identify Tables With Dropped Columns</h1><div class="postShorten-meta post-meta"><time datetime=2024-07-09T10:00:00Z>July 9, 2024</time></div></div><div class="post-content markdown"><div class=main-content-wrap><p>On my last article - <a href=https://claudioessilva.eu/2024/05/29/What-happens-when-we-drop-a-column-on-a-SQL-Server-table-Wheres-my-space/ target=_blank rel="noopener noreferrer">What happens when we drop a column on a SQL Server table? Where&rsquo;s my space?
</a>- I have shown what happens when we drop a column from a table.<br>Today, we are going to check if we have a way to find tables with dropped columns.</p><h2 id=why>Why?</h2><p>As we learnt, when we drop a column this is just a metadata operation and won’t clear the space that was being used. You may be asking - Do I have more tables with dropped columns that I’m not aware of? - And that is a legit question.<br>Let&rsquo;s see how we can achieve this.</p><h2 id=a-more-complex-resource-and-time-consuming-way>A more complex, resource and time-consuming way</h2><p>As we saw before we can check if a column was dropped from a table by inspecting a data page that belongs to it.</p><p>This means, that probably we can use that in some way to double-check if that is the case or not for more tables.</p><h3 id=just-text-wont-be-very-helpful>Just text won&rsquo;t be very helpful</h3><p>One of the examples that I have shown before was a dump of the output of the <code>DATA_PAGE</code> as text. A first knee-jerk reaction could be to use some <code>SUBSTRING</code>/<code>PATHINDEX</code> T-SQL functions to perform a search. However, that seems a little bit too much work.</p><h3 id=using-dbcc-pagewith-tableresults>Using DBCC PAGE&mldr;WITH TABLERESULTS</h3><p>I haven&rsquo;t mentioned before but we can output the content of the page in a tabular way instead of the text format. For that, we just need to append the <code>WITH TABLERESULTS</code> keywords when running the <code>DBCC PAGE</code> command.</p><p>First we need to get a <code>DATA_PAGE</code> id. As seen before, for that we need to get an <code>allocated_page_page_id</code> value from:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#75715e>-- 2012 or newer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> allocated_page_page_id
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> sys.dm_db_database_page_allocations(DB_ID(), OBJECT_ID(<span style=color:#e6db74>&#39;dbo.Client&#39;</span>), <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#e6db74>&#39;DETAILED&#39;</span>)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> page_type_desc <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DATA_PAGE&#39;</span>
</span></span></code></pre></div><p><a href=/img/2024/0415/GetDroppedColumns_Get_allocated_page_page_id_from_sys_dm_db_database_page_allocations.png><img src=/img/2024/0415/GetDroppedColumns_Get_allocated_page_page_id_from_sys_dm_db_database_page_allocations.png alt="Get allocated_page_page_id"></a></p><p>Then, we can pick the value <code>544</code> and run the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>DBCC PAGE (<span style=color:#e6db74>&#39;TableInternals&#39;</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>544</span>, <span style=color:#ae81ff>3</span>) <span style=color:#66d9ef>WITH</span> TABLERESULTS;
</span></span></code></pre></div><blockquote><p>Just a quick reminder that undocumented commands (like DBCC PAGE) should be used with caution, as they are not officially supported by Microsoft and could potentially cause issues in your database.</p></blockquote><p>We get the output in a table format like the following:<br><a href=/img/2024/0415/GetDroppedColumns_DBCC_PAGE_WITH_TABLERESULTS.png><img src=/img/2024/0415/GetDroppedColumns_DBCC_PAGE_WITH_TABLERESULTS.png alt="DBCC PAGE&mldr;WITH TABLERESULTS"></a></p><p>That said, we can run some extra lines of code to:</p><ol><li>dump the page content to a temporary table (<code>#DBCCPAGE</code>)</li><li>run a T-SQL query to search and filter our results.</li></ol><p>If you check carefully on the previous image, you can find, on the <code>Field</code> column, the value <code>DROPPED</code> highlighted below.
<a href=/img/2024/0415/GetDroppedColumns_DROPPED_NULL.png><img src=/img/2024/0415/GetDroppedColumns_DROPPED_NULL.png alt="DBCC PAGE&mldr;WITH TABLERESULTS"></a></p><p>Let&rsquo;s filter by that.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>IF</span> OBJECT_ID(<span style=color:#e6db74>&#39;tempdb..#DBCCPAGE&#39;</span>) <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>#</span>DBCCPAGE;
</span></span><span style=display:flex><span><span style=color:#66d9ef>GO</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>#</span>DBCCPAGE (
</span></span><span style=display:flex><span>    [ParentObject]  VARCHAR(<span style=color:#ae81ff>255</span>),
</span></span><span style=display:flex><span>    [<span style=color:#66d9ef>Object</span>]        VARCHAR(<span style=color:#ae81ff>255</span>),
</span></span><span style=display:flex><span>    [Field]         VARCHAR(<span style=color:#ae81ff>255</span>),
</span></span><span style=display:flex><span>    [Value]         VARCHAR(<span style=color:#ae81ff>255</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* (1) */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>#</span>DBCCPAGE
</span></span><span style=display:flex><span><span style=color:#66d9ef>EXECUTE</span> (<span style=color:#e6db74>&#39;DBCC PAGE (&#39;&#39;TableInternals&#39;&#39;, 1, 544, 3) WITH TABLERESULTS;&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* (2) */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> <span style=color:#f92672>#</span>DBCCPAGE
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> Field <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DROPPED&#39;</span>
</span></span></code></pre></div><p><a href=/img/2024/0415/GetDroppedColumns_Find_Records_DROPPED_NULL.png><img src=/img/2024/0415/GetDroppedColumns_Find_Records_DROPPED_NULL.png alt="Find Records with DROPPPED values"></a></p><p>This gives you an idea of one possibility to achieve this task. This example is just for one table and I&rsquo;m sure you could build some extra code around it to make it check all tables.
However, that isn&rsquo;t necessary(!) because there is a easier, less expensive (resource wise) and quicker way of doing it.</p><h2 id=a-better-and-faster-approach---relying-on-metadata>A better and faster approach - Relying on metadata</h2><p>What if we had a less cumbersome way to check if we have a column dropped within a table?</p><p>Enter some metadata views!<br>SQL Server provides some undocumented <a href="https://learn.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms189600%28v=sql.105%29?redirectedfrom=MSDN" target=_blank rel="noopener noreferrer">system internal views
</a>that hold some columns&rsquo; metadata that are very useful.</p><p>This system view <code>sys.system_internals_partition_columns</code> has an interesting column called <code>is_dropped</code> which, as you can imagine, will contain the value <code>1</code> when that same column was dropped but the table wasn&rsquo;t yet rebuilt.</p><p>Let&rsquo;s see it in action using our previous example.<br>The first part of the script will create a <code>Client</code> table with 3 columns and insert one record.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span> Client
</span></span><span style=display:flex><span><span style=color:#66d9ef>GO</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> Client
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>	Id			int <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>identity</span>(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>	FirstName	varchar(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>	DoB			datetime
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>GO</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* Insert one record */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> Client (FirstName, DoB)
</span></span><span style=display:flex><span><span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;Alex&#39;</span>, <span style=color:#e6db74>&#39;1900-01-01&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>GO</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* Show the record */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> Id, FirstName, DoB
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> Client
</span></span><span style=display:flex><span><span style=color:#66d9ef>GO</span>
</span></span></code></pre></div><p>Now, before we drop the <code>DoB</code> column let&rsquo;s see what is returned on the <code>is_dropped</code> column of the <code>sys.system_internals_partition_columns</code> system view for our table.<br>For that, we can run the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> object_name(p.object_id) <span style=color:#66d9ef>table_name</span>,
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>c</span>.[name] <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>column_name</span>,
</span></span><span style=display:flex><span>    	pc.partition_column_id,
</span></span><span style=display:flex><span>		pc.is_dropped
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> sys.system_internals_partitions p
</span></span><span style=display:flex><span>	  <span style=color:#66d9ef>JOIN</span> sys.system_internals_partition_columns pc
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>ON</span> p.partition_id <span style=color:#f92672>=</span> pc.partition_id
</span></span><span style=display:flex><span>	  <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns <span style=color:#66d9ef>c</span>
</span></span><span style=display:flex><span>  	    <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.object_id
</span></span><span style=display:flex><span>	   <span style=color:#66d9ef>AND</span> pc.partition_column_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.column_id
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> p.object_id <span style=color:#f92672>=</span> OBJECT_ID(<span style=color:#e6db74>&#39;Client&#39;</span>)
</span></span></code></pre></div><p>We can see our 3 columns with sequential IDs (<code>partition_column_id</code>) and the <code>is_dropped</code> property with value <code>0</code>.</p><p><a href=/img/2024/0415/GetDroppedColumns_Metadata_Before_Drop.png><img src=/img/2024/0415/GetDroppedColumns_Metadata_Before_Drop.png alt="Check Metadata Before Dropping a column"></a></p><p>Now, let&rsquo;s drop the <code>DoB</code> column:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> Client
</span></span><span style=display:flex><span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>COLUMN</span> DoB
</span></span><span style=display:flex><span><span style=color:#66d9ef>GO</span>
</span></span></code></pre></div><p>And rerun the previous query to check what has changed:</p><p><a href=/img/2024/0415/GetDroppedColumns_Metadata_After_Drop.png><img src=/img/2024/0415/GetDroppedColumns_Metadata_After_Drop.png alt="Check Metadata After Dropping a column"></a></p><p>As we can see we lost a column name (that was the <code>DoB</code> column), the <code>partition_column_id</code> changed from <code>3</code> to <code>67108865</code> and now the <code>is_dropped</code> property has the value <code>1</code>.</p><p>That means if we filter only by the <code>is_dropped</code> property we can do a search on all tables of our database.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> object_name(p.object_id) <span style=color:#66d9ef>table_name</span>,
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>c</span>.[name] <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>column_name</span>,
</span></span><span style=display:flex><span>    	pc.partition_column_id,
</span></span><span style=display:flex><span>		pc.is_dropped
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> sys.system_internals_partitions p
</span></span><span style=display:flex><span>	  <span style=color:#66d9ef>JOIN</span> sys.system_internals_partition_columns pc
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>ON</span> p.partition_id <span style=color:#f92672>=</span> pc.partition_id
</span></span><span style=display:flex><span>	  <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns <span style=color:#66d9ef>c</span>
</span></span><span style=display:flex><span>  	    <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.object_id
</span></span><span style=display:flex><span>	   <span style=color:#66d9ef>AND</span> pc.partition_column_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.column_id
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> pc.is_dropped <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p><a href=/img/2024/0415/GetDroppedColumns_Metadata_All_is_dropped_columns.png><img src=/img/2024/0415/GetDroppedColumns_Metadata_All_is_dropped_columns.png alt="Get all tables with dropped columns"></a></p><p>Cool stuff!</p><blockquote><p><strong>NOTE:</strong> With this query, if you have dropped columns on a partitioned table, you will get a record for each existing partition of that same table.</p></blockquote><h2 id=wrap-up>Wrap up</h2><p>In this article, we saw the output of the contents of a page using <code>DBCC PAGE</code> with a table format and how that could let us use T-SQL to filter records, like if we have dropped columns.
We then saw an easier way to find our dropped columns by using some undocumented system views.</p><p>In my next article, I will share how we can have an idea of how much space our dropped columns are still holding so you can decide how quickly you want to schedule some maintenance tasks to recover that space.</p><p>Thanks for reading</p></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">TAGGED IN</span><br><a class="tag tag--primary tag--small" href=/tags/SQLServer/>SQLServer</a>
<a class="tag tag--primary tag--small" href=/tags/TSQL/>TSQL</a>
<a class="tag tag--primary tag--small" href=/tags/DBA/>DBA</a>
<a class="tag tag--primary tag--small" href=/tags/Internals/>Internals</a>
<a class="tag tag--primary tag--small" href=/tags/DBCC-PAGE/>DBCC PAGE</a>
<a class="tag tag--primary tag--small" href=/tags/system_internals_partition_columns/>system_internals_partition_columns</a>
<a class="tag tag--primary tag--small" href=/tags/drop-columns/>drop columns</a>
<a class="tag tag--primary tag--small" href=/tags/syndicated/>syndicated</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2024/05/29/What-happens-when-we-drop-a-column-on-a-SQL-Server-table-Wheres-my-space/ data-tooltip="What happens when we drop a column on a SQL Server table? Where's my space?" aria-label="PREVIOUS: What happens when we drop a column on a SQL Server table? Where's my space?"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://claudioessilva.eu/2024/07/09/Identify-Tables-With-Dropped-Columns/" title="Share on Facebook" aria-label="Share on Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://claudioessilva.eu/2024/07/09/Identify-Tables-With-Dropped-Columns/" title="Share on Twitter" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://claudioessilva.eu/2024/07/09/Identify-Tables-With-Dropped-Columns/" title="Share on Linkedin" aria-label="Share on Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label="Back to top"><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div><div class=comments><script src=https://utteranc.es/client.js repo=ClaudioESSilva/blog-comments issue-term=og:title theme=github-light crossorigin=anonymous async></script></div></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2024 Cláudio Silva. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2024/05/29/What-happens-when-we-drop-a-column-on-a-SQL-Server-table-Wheres-my-space/ data-tooltip="What happens when we drop a column on a SQL Server table? Where's my space?" aria-label="PREVIOUS: What happens when we drop a column on a SQL Server table? Where's my space?"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://claudioessilva.eu/2024/07/09/Identify-Tables-With-Dropped-Columns/" title="Share on Facebook" aria-label="Share on Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://claudioessilva.eu/2024/07/09/Identify-Tables-With-Dropped-Columns/" title="Share on Twitter" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://claudioessilva.eu/2024/07/09/Identify-Tables-With-Dropped-Columns/" title="Share on Linkedin" aria-label="Share on Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label="Back to top"><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div><div id=share-options-bar class=share-options-bar data-behavior=4><i id=btn-close-shareoptions class="fa fa-times"></i><ul class=share-options><li class=share-option><a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fclaudioessilva.eu%2F2024%2F07%2F09%2FIdentify-Tables-With-Dropped-Columns%2F" aria-label="Share on Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i><span>Share on Facebook</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fclaudioessilva.eu%2F2024%2F07%2F09%2FIdentify-Tables-With-Dropped-Columns%2F" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden=true></i><span>Share on Twitter</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fclaudioessilva.eu%2F2024%2F07%2F09%2FIdentify-Tables-With-Dropped-Columns%2F" aria-label="Share on Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i><span>Share on Linkedin</span></a></li></ul></div><div id=share-options-mask class=share-options-mask></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-times"></i></div><img id=about-card-picture src=https://claudioessilva.eu/img/avatar.jpg alt="Author's picture"><h4 id=about-card-name>Cláudio Silva</h4><div id=about-card-bio>Data Platform Architect and PowerShell lover.</div><div id=about-card-job><i class="fa fa-briefcase"></i><br>Data Platform Architect</div><div id=about-card-location><i class="fa fa-map-marker-alt"></i><br>Portugal</div></div></div><div id=cover style=background-image:url(https://claudioessilva.eu/images/cover_bridge.jpg)></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://claudioessilva.eu/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js></script><script>$(document).ready(function(){hljs.configure({classPrefix:"",useBR:!1}),$("pre.code-highlight > code, pre > code").each(function(e,t){$(this).hasClass("codeblock")||$(this).addClass("codeblock"),hljs.highlightBlock(t)})})</script></body></html>