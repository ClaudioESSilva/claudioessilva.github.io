<!doctype html><html lang=en-us><head><script type=application/ld+json>{"@context":"http://schema.org","@type":"Website","@id":"https:\/\/claudioessilva.eu\/","author":{"@type":"Person","name":null},"name":"Cl치udio Silva\u0027s Blog","description":"\u003cp\u003eIn my last article - \u003ca href=\u0022https:\/\/www.sqlservercentral.com\/articles\/identify-tables-with-dropped-columns\u0022\n\n \n    target=\u0022_blank\u0022 rel=\u0022noopener noreferrer\u0022\n\u003e\n   Identify Tables With Dropped Columns\n\u003c\/a\u003e\n - we saw how we can identify tables that have columns that were dropped. \u003cbr\u003e\nToday, we are going to check a way to approximately calculate how much space we can expect to recover if we rebuild our table.\u003c\/p\u003e\n\u003cp\u003eIf you want to read the 1st article I published on this subject, you can read it here - \u003ca href=\u0022https:\/\/www.sqlservercentral.com\/articles\/what-happens-when-we-drop-a-column-on-a-sql-server-table-wheres-my-space\u0022\n\n \n    target=\u0022_blank\u0022 rel=\u0022noopener noreferrer\u0022\n\u003e\n   What happens when we drop a column on a SQL Server table? Where\u0026rsquo;s my space?\n\u003c\/a\u003e\n\u003c\/p\u003e","url":"https:\/\/claudioessilva.eu\/2024\/08\/05\/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column\/","keywords":"[]"}</script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo 0.145.0 with theme Tranquilpeak 0.5.3-BETA"><meta name=author content><meta name=keywords content><meta name=description content="In my last article - 
   Identify Tables With Dropped Columns

 - we saw how we can identify tables that have columns that were dropped. 
Today, we are going to check a way to approximately calculate how much space we can expect to recover if we rebuild our table.
If you want to read the 1st article I published on this subject, you can read it here - 
   What happens when we drop a column on a SQL Server table? Where&rsquo;s my space?

"><meta property="og:description" content="In my last article - 
   Identify Tables With Dropped Columns

 - we saw how we can identify tables that have columns that were dropped. 
Today, we are going to check a way to approximately calculate how much space we can expect to recover if we rebuild our table.
If you want to read the 1st article I published on this subject, you can read it here - 
   What happens when we drop a column on a SQL Server table? Where&rsquo;s my space?

"><meta property="og:type" content="article"><meta property="og:title" content="How much space can I expect to recover from a rebuild after dropping a column?"><meta name=twitter:title content="How much space can I expect to recover from a rebuild after dropping a column?"><meta property="og:url" content="https://claudioessilva.eu/2024/08/05/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column/"><meta property="twitter:url" content="https://claudioessilva.eu/2024/08/05/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column/"><meta property="og:site_name" content="Cl치udio Silva's Blog"><meta property="og:description" content="In my last article - 
   Identify Tables With Dropped Columns

 - we saw how we can identify tables that have columns that were dropped. 
Today, we are going to check a way to approximately calculate how much space we can expect to recover if we rebuild our table.
If you want to read the 1st article I published on this subject, you can read it here - 
   What happens when we drop a column on a SQL Server table? Where&rsquo;s my space?

"><meta name=twitter:description content="In my last article - 
   Identify Tables With Dropped Columns

 - we saw how we can identify tables that have columns that were dropped. 
Today, we are going to check a way to approximately calculate how much space we can expect to recover if we rebuild our table.
If you want to read the 1st article I published on this subject, you can read it here - 
   What happens when we drop a column on a SQL Server table? Where&rsquo;s my space?

"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2024-08-05T10:00:00"><meta property="article:modified_time" content="2024-08-05T10:00:00"><meta property="article:tag" content="SQLServer"><meta property="article:tag" content="TSQL"><meta property="article:tag" content="DBA"><meta property="article:tag" content="Internals"><meta property="article:tag" content="DBCC PAGE"><meta property="article:tag" content="system_internals_partition_columns"><meta property="article:tag" content="drop columns"><meta property="article:tag" content="syndicated"><meta name=twitter:card content="summary"><meta property="og:image" content="https://claudioessilva.eu/img/2024/0611/howMuchSpaceCanIRecover_coverImage.png"><meta property="twitter:image" content="https://claudioessilva.eu/img/2024/0611/howMuchSpaceCanIRecover_coverImage.png"><meta property="og:image" content="https://claudioessilva.eu/img/2024/0611/howMuchSpaceCanIRecover_coverImage.png"><meta property="twitter:image" content="https://claudioessilva.eu/img/2024/0611/howMuchSpaceCanIRecover_coverImage.png"><meta property="og:image" content="https://claudioessilva.eu/img/2024/0611/howMuchSpaceCanIRecover_thumbnailImage.png"><meta property="twitter:image" content="https://claudioessilva.eu/img/2024/0611/howMuchSpaceCanIRecover_thumbnailImage.png"><title>How much space can I expect to recover from a rebuild after dropping a column?</title>
<link rel=icon href=https://claudioessilva.eu/img/favicon.jpg><link rel=canonical href=https://claudioessilva.eu/2024/08/05/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://claudioessilva.eu/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-55EWW6EWZM"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-55EWW6EWZM")}</script></head><body><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=/ aria-label="Go to homepage">Cl치udio Silva's Blog</a></div><a class=header-right-picture href=/#about aria-label="Open the link: /#about"></a></header><nav id=sidebar data-behavior=4><div class=sidebar-container><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/ title=Home><i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden=true></i>
<span class=sidebar-button-desc>Home</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/tags title=Tags><i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden=true></i>
<span class=sidebar-button-desc>Tags</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/#about title=About><i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden=true></i>
<span class=sidebar-button-desc>About</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/claudioessilva target=_blank rel=noopener title=GitHub><i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden=true></i>
<span class=sidebar-button-desc>GitHub</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://twitter.com/claudioessilva target=_blank rel=noopener title=Twitter><i class="sidebar-button-icon fab fa-lg fa-twitter" aria-hidden=true></i>
<span class=sidebar-button-desc>Twitter</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://www.linkedin.com/in/claudioessilva target=_blank rel=noopener title=LinkedIn><i class="sidebar-button-icon fab fa-lg fa-linkedin" aria-hidden=true></i>
<span class=sidebar-button-desc>LinkedIn</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/index.xml title=RSS><i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden=true></i>
<span class=sidebar-button-desc>RSS</span></a></li></ul></div><div class=sidebar-container><div style=color:#ebebeb;font-size:25px;text-align:center>dbatools book</div><div style=color:#ebebeb;font-size:15px>Now available! Buy it at manning.com - 50% off with code bldbatools50</div><a href="https://www.manning.com/books/learn-dbatools-in-a-month-of-lunches?utm_source=claudioessilva&utm_medium=affiliate&utm_campaign=affiliate&a_aid=claudioessilva" target=_blank><center><img src=https://images.manning.com/264/352/resize/book/0/998b76f-982a-4661-a020-5d94909f7ea5/LeMaire-HI.png height=300></center></a></div></nav><div class="post-header-cover
text-center" style=background-image:url(/img/2024/0611/howMuchSpaceCanIRecover_coverImage.png);height:30% data-behavior=4></div><div id=main data-behavior=4 class="hasCover
hasCoverMetaOut"><article class=post id=top><div class="post-header main-content-wrap text-center"><h1 class=post-title>How much space can I expect to recover from a rebuild after dropping a column?</h1><div class="postShorten-meta post-meta"><time datetime=2024-08-05T10:00:00Z>August 5, 2024</time></div></div><div class="post-content markdown"><div class=main-content-wrap><p>In my last article - <a href=https://www.sqlservercentral.com/articles/identify-tables-with-dropped-columns target=_blank rel="noopener noreferrer">Identify Tables With Dropped Columns
</a>- we saw how we can identify tables that have columns that were dropped.<br>Today, we are going to check a way to approximately calculate how much space we can expect to recover if we rebuild our table.</p><p>If you want to read the 1st article I published on this subject, you can read it here - <a href=https://www.sqlservercentral.com/articles/what-happens-when-we-drop-a-column-on-a-sql-server-table-wheres-my-space target=_blank rel="noopener noreferrer">What happens when we drop a column on a SQL Server table? Where&rsquo;s my space?</a></p><h2 id=why-can-this-be-important>Why can this be important?</h2><p>Rebuilding a table is, by default, an offline operation! This means the table will have a lock and other sessions can&rsquo;t read from it while the rebuild is running.
However, if you are running an Enterprise edition you can use the <code>ONLINE = ON</code> option to minimize this. The table won&rsquo;t be locked for the whole period of the rebuild.</p><p>That is why it&rsquo;s important to estimate how much space we can recover from a rebuild, after dropping a column. Your mileage will vary but if you expect to recover dozens or even hundreds of GB maybe it will be more interesting to do the rebuild soon rather than later, but if it is just a dozen of MB and that won&rsquo;t make a big difference, you can defer that to a later maintenance window.</p><h2 id=picking-from-where-we-left-it>Picking from where we left it</h2><blockquote><p><strong>NOTE:</strong> I haven&rsquo;t mentioned this before but, these scripts don&rsquo;t work on Azure SQL DB, but it does work on Azure SQL Managed Instance.</p></blockquote><p>In the last article, I ended with the following code block as an option to find the dropped columns.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> object_name(p.object_id) <span style=color:#66d9ef>table_name</span>, 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>c</span>.[name] <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>column_name</span>, 
</span></span><span style=display:flex><span>        pc.partition_column_id, 
</span></span><span style=display:flex><span>        pc.is_dropped 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> sys.system_internals_partitions p 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>JOIN</span> sys.system_internals_partition_columns pc 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>ON</span> p.partition_id <span style=color:#f92672>=</span> pc.partition_id 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns <span style=color:#66d9ef>c</span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.object_id 
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>AND</span> pc.partition_column_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.column_id 
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> pc.is_dropped <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> 
</span></span></code></pre></div><p>This doesn&rsquo;t output a lot of columns on purpose. We just needed the columns <code>table_name</code> and <code>column_name</code> (which is always <code>NULL</code> in this case) where <code>is_dropped = 1</code> to know the objects with dropped columns.</p><h3 id=butthere-is-more>But&mldr;there is more!</h3><p>If we explore the columns that belong to the <code>sys.system_internals_partition_columns</code> system view, we can see that it returns a total of 28 columns (at least for the SQL Server 2022 version).</p><p><a href=/img/2024/0611/sp_help_sys_system_internals_partition_columns.png><img src=/img/2024/0611/sp_help_sys_system_internals_partition_columns.png alt=sys.sys_system_internals_partition_columns></a></p><p>As mentioned before, this system view is not documented. This means we can only infer/assume some info based on the column name and its contents.</p><h4 id=the-max_length-column>The <code>max_length</code> column</h4><p>To be able to calculate the space being wasted by the column that was dropped, we will need to know the size that column occupies on each record. For fixed-length data types, that will be the <code>max_length</code> column.</p><h4 id=the-number-of-rows>The number of rows</h4><p>To have the total KB that our dropped column is still occupying, we will need to multiply the <code>max_length</code> column by the number of records that we have on the table.
For that, we will need to use the column <code>rows</code> that we can obtain from the <code>sys.system_internals_partitions</code> system view.</p><h2 id=a-practical-example>A practical example</h2><p>Picking our <code>Client</code> table where we have dropped the <code>DoB</code> column, let&rsquo;s see if this math works.<br>A column of data type <code>datetime</code> occupies 8 bytes. We can see that from the <code>max_length</code> column.</p><p><a href=/img/2024/0611/column_max_length.png><img src=/img/2024/0611/column_max_length.png alt="Shows max_length property"></a></p><p>Let&rsquo;s say our table has 50000 rows.<br>This will mean that 50000 (rows) * 8 (bytes) = 400000 (bytes).<br>To convert that to KB, we will need to divide this result by 1000 we will get 400 KB.<br>Knowing that each data page has 8 KB we can say that we are wasting 50 pages (400 / 8).</p><h2 id=confirming-it>Confirming it</h2><p>To confirm this is true, I have added some columns to our query.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> 
</span></span><span style=display:flex><span>        OBJECT_NAME(p.object_id) <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>table_name</span>, 
</span></span><span style=display:flex><span>        COALESCE(cx.[name], <span style=color:#66d9ef>c</span>.[name]) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>column_name</span>, 
</span></span><span style=display:flex><span>        pc.partition_column_id, 
</span></span><span style=display:flex><span>        pc.is_dropped, 
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* 
</span></span></span><span style=display:flex><span><span style=color:#75715e>            New columns added 
</span></span></span><span style=display:flex><span><span style=color:#75715e>        */</span> 
</span></span><span style=display:flex><span>        pc.max_length, 
</span></span><span style=display:flex><span>        p.[<span style=color:#66d9ef>rows</span>], 
</span></span><span style=display:flex><span>        pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>] <span style=color:#66d9ef>AS</span> total_bytes, 
</span></span><span style=display:flex><span>        (pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span> <span style=color:#66d9ef>AS</span> total_kb, 
</span></span><span style=display:flex><span>        (pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>8</span> <span style=color:#66d9ef>AS</span> total_pages 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> sys.system_internals_partitions p 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>JOIN</span> sys.system_internals_partition_columns pc 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.partition_id <span style=color:#f92672>=</span> pc.partition_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.index_columns ic 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> ic.object_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.index_id <span style=color:#f92672>=</span> p.index_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.index_column_id <span style=color:#f92672>=</span> pc.partition_column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns <span style=color:#66d9ef>c</span> 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.object_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.column_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns cx 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> cx.object_id  
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> pc.partition_column_id <span style=color:#f92672>=</span> cx.column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CROSS</span> APPLY sys.dm_db_index_physical_stats(DB_ID(), p.object_id, p.index_id, <span style=color:#66d9ef>DEFAULT</span>, <span style=color:#e6db74>&#39;LIMITED&#39;</span>) <span style=color:#66d9ef>AS</span> ddips 
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> p.object_id <span style=color:#f92672>=</span> object_id(<span style=color:#e6db74>&#39;dbo.Client&#39;</span>) 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>AND</span> p.index_id <span style=color:#66d9ef>IN</span> (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>) 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>AND</span> is_dropped <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> 
</span></span></code></pre></div><p><a href=/img/2024/0611/calculation_wasting_space.png><img src=/img/2024/0611/calculation_wasting_space.png alt="Calculation of the wasting space"></a></p><h3 id=the-before-and-the-after>The before and the after</h3><p>With the previous query, we already have an idea of the number of pages and therefore the amount of KB that we may be able to recover after a rebuild.<br>However, to add a bit more detail to our investigation let&rsquo;s put the current size and the expected one, after rebuilding, side-by-side.</p><p>For this, we will need to know what the actual number of pages that our table is using is. For that, we can use the dynamic management function (DMF) <code>sys.dm_db_index_physical_stats</code> that returns the <code>page_count</code> column. As it is a DMF, to add to our query we will use a <code>CROSS APPLY</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> 
</span></span><span style=display:flex><span>        OBJECT_NAME(p.object_id) <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>table_name</span>, 
</span></span><span style=display:flex><span>        COALESCE(cx.[name], <span style=color:#66d9ef>c</span>.[name]) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>column_name</span>, 
</span></span><span style=display:flex><span>        pc.partition_column_id, 
</span></span><span style=display:flex><span>        pc.is_dropped, 
</span></span><span style=display:flex><span>        pc.max_length, 
</span></span><span style=display:flex><span>        p.[<span style=color:#66d9ef>rows</span>], 
</span></span><span style=display:flex><span>        pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>] <span style=color:#66d9ef>AS</span> total_bytes, 
</span></span><span style=display:flex><span>        (pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span> <span style=color:#66d9ef>AS</span> total_kb, 
</span></span><span style=display:flex><span>        (pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>8</span> <span style=color:#66d9ef>AS</span> total_pages, 
</span></span><span style=display:flex><span>        ddips.page_count <span style=color:#66d9ef>AS</span> current_page_ount <span style=color:#75715e>/* New column added */</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> sys.system_internals_partitions p 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>JOIN</span> sys.system_internals_partition_columns pc 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.partition_id <span style=color:#f92672>=</span> pc.partition_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.index_columns ic 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> ic.object_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.index_id <span style=color:#f92672>=</span> p.index_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.index_column_id <span style=color:#f92672>=</span> pc.partition_column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns <span style=color:#66d9ef>c</span> 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.object_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.column_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns cx 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> cx.object_id  
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> pc.partition_column_id <span style=color:#f92672>=</span> cx.column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CROSS</span> APPLY sys.dm_db_index_physical_stats(DB_ID(), p.object_id, p.index_id, <span style=color:#66d9ef>DEFAULT</span>, <span style=color:#e6db74>&#39;LIMITED&#39;</span>) <span style=color:#66d9ef>AS</span> ddips 
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> p.object_id <span style=color:#f92672>=</span> object_id(<span style=color:#e6db74>&#39;dbo.Client&#39;</span>) 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>AND</span> p.index_id <span style=color:#66d9ef>IN</span> (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>) 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>AND</span> is_dropped <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> 
</span></span></code></pre></div><p><a href=/img/2024/0611/calculation_wasting_space_with_current_page_count.png><img src=/img/2024/0611/calculation_wasting_space_with_current_page_count.png alt="Calculation of the wasting space"></a></p><p>With this, we can see that we have 180 data pages.<br>Now, all we need to do is some math 游때</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> 
</span></span><span style=display:flex><span>        OBJECT_NAME(p.object_id) <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>table_name</span>, 
</span></span><span style=display:flex><span>        COALESCE(cx.[name], <span style=color:#66d9ef>c</span>.[name]) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>column_name</span>, 
</span></span><span style=display:flex><span>        pc.partition_column_id, 
</span></span><span style=display:flex><span>        pc.is_dropped, 
</span></span><span style=display:flex><span>        pc.max_length, 
</span></span><span style=display:flex><span>        p.[<span style=color:#66d9ef>rows</span>], 
</span></span><span style=display:flex><span>        pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>] <span style=color:#66d9ef>AS</span> total_bytes, 
</span></span><span style=display:flex><span>        (pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span> <span style=color:#66d9ef>AS</span> total_kb, 
</span></span><span style=display:flex><span>        (pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>8</span> <span style=color:#66d9ef>AS</span> total_pages, 
</span></span><span style=display:flex><span>        ddips.page_count <span style=color:#66d9ef>AS</span> current_page_ount, 
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* 
</span></span></span><span style=display:flex><span><span style=color:#75715e>            New columns added 
</span></span></span><span style=display:flex><span><span style=color:#75715e>        */</span> 
</span></span><span style=display:flex><span>        ddips.page_count <span style=color:#f92672>-</span> (pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>] <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>8</span>) <span style=color:#66d9ef>AS</span> new_page_count, 
</span></span><span style=display:flex><span>        ddips.page_count <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#66d9ef>AS</span> current_data_size_kb, 
</span></span><span style=display:flex><span>        (ddips.page_count <span style=color:#f92672>-</span> (pc.max_length <span style=color:#f92672>*</span> p.[<span style=color:#66d9ef>rows</span>] <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>8</span>)) <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#66d9ef>AS</span> new_data_size_kb 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> sys.system_internals_partitions p 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>JOIN</span> sys.system_internals_partition_columns pc 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.partition_id <span style=color:#f92672>=</span> pc.partition_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.index_columns ic 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> ic.object_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.index_id <span style=color:#f92672>=</span> p.index_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.index_column_id <span style=color:#f92672>=</span> pc.partition_column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns <span style=color:#66d9ef>c</span> 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.object_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.column_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns cx 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> cx.object_id  
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> pc.partition_column_id <span style=color:#f92672>=</span> cx.column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CROSS</span> APPLY sys.dm_db_index_physical_stats(DB_ID(), p.object_id, p.index_id, <span style=color:#66d9ef>DEFAULT</span>, <span style=color:#e6db74>&#39;LIMITED&#39;</span>) <span style=color:#66d9ef>AS</span> ddips 
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> p.object_id <span style=color:#f92672>=</span> object_id(<span style=color:#e6db74>&#39;dbo.Client&#39;</span>) 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>AND</span> p.index_id <span style=color:#66d9ef>IN</span> (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>) 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>AND</span> is_dropped <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> 
</span></span></code></pre></div><p><a href=/img/2024/0611/calculation_wasting_space_with_all_columns.png><img src=/img/2024/0611/calculation_wasting_space_with_all_columns.png alt="Comparison between current and expected new values"></a></p><h2 id=the-final-proof>The final proof</h2><p>To confirm if our math works, let&rsquo;s rebuild our table so we can get rid of the extra space left by the drop action and check how many data pages is the table using.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#75715e>-- Let&#39;s clear the dropped column and tidy up things 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> Client REBUILD  
</span></span></code></pre></div><p>Checking the current number of data pages - for that we can run the following query:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> 
</span></span><span style=display:flex><span>        OBJECT_NAME(p.object_id) <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>table_name</span>, 
</span></span><span style=display:flex><span>        COALESCE(cx.[name], <span style=color:#66d9ef>c</span>.[name]) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>column_name</span>, 
</span></span><span style=display:flex><span>        pc.partition_column_id, 
</span></span><span style=display:flex><span>        pc.is_dropped, 
</span></span><span style=display:flex><span>        pc.max_length, 
</span></span><span style=display:flex><span>        p.[<span style=color:#66d9ef>rows</span>], 
</span></span><span style=display:flex><span>        ddips.page_count <span style=color:#66d9ef>AS</span> current_page_ount 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> sys.system_internals_partitions p 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>JOIN</span> sys.system_internals_partition_columns pc 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.partition_id <span style=color:#f92672>=</span> pc.partition_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.index_columns ic 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> ic.object_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.index_id <span style=color:#f92672>=</span> p.index_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.index_column_id <span style=color:#f92672>=</span> pc.partition_column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns <span style=color:#66d9ef>c</span> 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.object_id 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> ic.column_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> sys.columns cx 
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>ON</span> p.object_id <span style=color:#f92672>=</span> cx.object_id  
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>AND</span> pc.partition_column_id <span style=color:#f92672>=</span> cx.column_id 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>CROSS</span> APPLY sys.dm_db_index_physical_stats(DB_ID(), p.object_id, p.index_id, <span style=color:#66d9ef>DEFAULT</span>, <span style=color:#e6db74>&#39;LIMITED&#39;</span>) <span style=color:#66d9ef>AS</span> ddips 
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> p.object_id <span style=color:#f92672>=</span> object_id(<span style=color:#e6db74>&#39;dbo.Client&#39;</span>) 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>AND</span> p.index_id <span style=color:#66d9ef>IN</span> (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>) 
</span></span></code></pre></div><p><a href=/img/2024/0611/new_page_count.png><img src=/img/2024/0611/new_page_count.png alt="New page count"></a></p><p>As we can see on the image, the <code>current_page_count</code> is now <code>130</code> which matches the <code>new_page_count</code> column in the previous query.</p><h2 id=how-accurate-is-this>How accurate is this?</h2><p>You should use this script and analyse the results with a pinch of salt.<br>My idea wasn&rsquo;t to build a one-size-fits-all script but rather to check if the math would add up and would be enough to rely on it for specific situations.</p><p>Feel free to pick the script and adapt it as you wish.<br>Also, check below for some of the reasons why it isn&rsquo;t a one-size-fits-all.</p><h2 id=this-works-well-for-fixed-length-columns-and-no-compression-and>This works well for fixed-length columns and no compression and&mldr;</h2><p>The attentive reader may be wondering &ldquo;Ok, this was on a HEAP!&rdquo;.</p><ul><li>What if the table has a CLUSTERED index?</li><li>What if our column that was dropped doesn&rsquo;t have a fixed-length?</li><li>Or if it was nullable?</li><li>Will these calculations work the same way if we are using compression?</li><li>And, what happens if I have NONCLUSTERED indexes using the column?</li></ul><p>Let me answer all these five questions.</p><h3 id=will-these-calculations-work-the-same-way-if-we-are-using-compression>&ldquo;Will these calculations work the same way if we are using compression?&rdquo;</h3><p>Let me address this one first because this is a show-stopper for this script.<br>If the table is compressed, the script can/will return some odd results as it doesn&rsquo;t take into account that the data type used by the column can occupy less space (can be compressed), which will lead to abnormal (ultimately can lead to negative) values.<br>Therefore, the answer is no. The way the script is built won&rsquo;t be a good fit for tables that are compressed.</p><h3 id=what-if-the-table-has-a-clustered-index>&ldquo;What if the table has a CLUSTERED index?&rdquo;</h3><p>As long as the table isn&rsquo;t compressed, the same script can still be used to have a good guess.
You can test by yourself, create a CLUSTERED index on the table and run the scripts again.</p><h3 id=what-if-the-column-that-was-dropped-doesnt-have-a-fixed-length>&ldquo;What if the column that was dropped doesn&rsquo;t have a fixed length?</h3><p>When a column doesn&rsquo;t have a fixed length, and it&rsquo;s already dropped, you won&rsquo;t have any metadata to give you an approximate size (an average_record_size). In this case, probably your best bet is to decide on a value as the average occupied by that column to do the calculation.</p><p>Example:<br>If we have a <code>VARCHAR(50)</code> column, we will see the <code>max_length</code> showing <code>50</code> however, if we know that on average, we only have 20 chars, we can use that to have an estimate.<br>If you don&rsquo;t have that info, I would suggest using half of the size <code>25</code> in this example. At this point, it will be as good of a guess as any other.</p><h3 id=or-if-its-nullable>&ldquo;Or if it&rsquo;s nullable?&rdquo;</h3><p>If the column has a fixed length being nullable or not doesn&rsquo;t matter. It <a href=https://weblogs.sqlteam.com/mladenp/2007/09/06/how_does_sql_server_really_store_null-s/ target=_blank rel="noopener noreferrer">occupies the same number of bytes
</a>as when the column has a value different than <code>NULL</code>.</p><blockquote><p>NOTE: Unless you use <a href=https://learn.microsoft.com/en-us/sql/relational-databases/tables/use-sparse-columns target=_blank rel="noopener noreferrer">Sparse Columns
</a>but that is a different story with some <a href="https://learn.microsoft.com/en-us/sql/relational-databases/tables/use-sparse-columns?view=sql-server-ver16#restrictions-for-using-sparse-columns" target=_blank rel="noopener noreferrer">restrictions/caveats
</a>.</p></blockquote><h3 id=and-nonclustered-indexes>&ldquo;And NONCLUSTERED indexes?&rdquo;</h3><p>We can&rsquo;t drop a column that is part of a NONCLUSTERED index without disable/drop that same index first.<br>This script is written to do calculations on the actual data (HEAP/CLUSTERED index) and not on a copy of the data (NONCLUSTERED index).</p><h2 id=wrap-up>Wrap up</h2><p>In this article, we modified the script to get the table with dropped columns to have more detail to be able to calculate how much space we are wasting after that column is dropped.<br>We also mentioned a bunch of caveats that you need to be aware of, depending on the table structure, that can make this script not produce the expected value.</p><p>I hope you find this example educational and that you can use it to do some testing by yourself.</p><p>Thanks for reading.</p></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">TAGGED IN</span><br><a class="tag tag--primary tag--small" href=/tags/SQLServer/>SQLServer</a>
<a class="tag tag--primary tag--small" href=/tags/TSQL/>TSQL</a>
<a class="tag tag--primary tag--small" href=/tags/DBA/>DBA</a>
<a class="tag tag--primary tag--small" href=/tags/Internals/>Internals</a>
<a class="tag tag--primary tag--small" href=/tags/DBCC-PAGE/>DBCC PAGE</a>
<a class="tag tag--primary tag--small" href=/tags/system_internals_partition_columns/>system_internals_partition_columns</a>
<a class="tag tag--primary tag--small" href=/tags/drop-columns/>drop columns</a>
<a class="tag tag--primary tag--small" href=/tags/syndicated/>syndicated</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2024/07/09/Identify-Tables-With-Dropped-Columns/ data-tooltip="Identify Tables With Dropped Columns" aria-label="PREVIOUS: Identify Tables With Dropped Columns"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://claudioessilva.eu/2024/08/05/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column/" title="Share on Facebook" aria-label="Share on Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://claudioessilva.eu/2024/08/05/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column/" title="Share on Twitter" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://claudioessilva.eu/2024/08/05/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column/" title="Share on Linkedin" aria-label="Share on Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label="Back to top"><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div><div class=comments><script src=https://utteranc.es/client.js repo=ClaudioESSilva/blog-comments issue-term=og:title theme=github-light crossorigin=anonymous async></script></div></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2025 Cl치udio Silva's Blog. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2024/07/09/Identify-Tables-With-Dropped-Columns/ data-tooltip="Identify Tables With Dropped Columns" aria-label="PREVIOUS: Identify Tables With Dropped Columns"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://claudioessilva.eu/2024/08/05/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column/" title="Share on Facebook" aria-label="Share on Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://claudioessilva.eu/2024/08/05/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column/" title="Share on Twitter" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://claudioessilva.eu/2024/08/05/How-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column/" title="Share on Linkedin" aria-label="Share on Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label="Back to top"><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div><div id=share-options-bar class=share-options-bar data-behavior=4><i id=btn-close-shareoptions class="fa fa-times"></i><ul class=share-options><li class=share-option><a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fclaudioessilva.eu%2F2024%2F08%2F05%2FHow-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column%2F" aria-label="Share on Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i><span>Share on Facebook</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fclaudioessilva.eu%2F2024%2F08%2F05%2FHow-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column%2F" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden=true></i><span>Share on Twitter</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fclaudioessilva.eu%2F2024%2F08%2F05%2FHow-much-space-can-I-expect-to-recover-from-a-rebuild-after-dropping-a-column%2F" aria-label="Share on Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i><span>Share on Linkedin</span></a></li></ul></div><div id=share-options-mask class=share-options-mask></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-times"></i></div><h4 id=about-card-name></h4></div></div><div id=cover style=background-image:url(https://claudioessilva.eu/images/cover_bridge.jpg)></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://claudioessilva.eu/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js></script><script>$(document).ready(function(){hljs.configure({classPrefix:"",useBR:!1}),$("pre.code-highlight > code, pre > code").each(function(e,t){$(this).hasClass("codeblock")||$(this).addClass("codeblock"),hljs.highlightBlock(t)})})</script></body></html>