<!doctype html><html lang=en-us><head><script type=application/ld+json>{"@context":"http://schema.org","@type":"Website","@id":"https:\/\/claudioessilva.eu\/","author":{"@type":"Person","name":"Cláudio Silva","image":"https://claudioessilva.eu/img/avatar.jpg"},"name":"Cláudio Silva\u0027s Blog","description":"Few days ago I was surfing on Twitter when dbatools asked about how it\u0026rsquo;s PowerShell module changed the way people work .\nOpen and check the answers given by the community as there is really good stuff there!\nMy turn I have shared one of my recipes related to database refreshes. You know, when the client says, \u0026ldquo;please restore this backup or the most recent backup on our instance.\u0026rdquo;. But what if the databases belong to an availability group?","url":"https:\/\/claudioessilva.eu\/2020\/05\/20\/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools\/","keywords":"[]"}</script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo 0.128.2 with theme Tranquilpeak 0.5.3-BETA"><meta name=author content="Cláudio Silva"><meta name=keywords content><meta name=description content="Few days ago I was surfing on Twitter when dbatools asked about how it&rsquo;s PowerShell module changed the way people work .
Open and check the answers given by the community as there is really good stuff there!
My turn I have shared one of my recipes related to database refreshes. You know, when the client says, &ldquo;please restore this backup or the most recent backup on our instance.&rdquo;. But what if the databases belong to an availability group?"><meta property="og:description" content="Few days ago I was surfing on Twitter when dbatools asked about how it&rsquo;s PowerShell module changed the way people work .
Open and check the answers given by the community as there is really good stuff there!
My turn I have shared one of my recipes related to database refreshes. You know, when the client says, &ldquo;please restore this backup or the most recent backup on our instance.&rdquo;. But what if the databases belong to an availability group?"><meta property="og:type" content="article"><meta property="og:title" content="Refresh databases that belongs to Availability Group using dbatools"><meta name=twitter:title content="Refresh databases that belongs to Availability Group using dbatools"><meta property="og:url" content="https://claudioessilva.eu/2020/05/20/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools/"><meta property="twitter:url" content="https://claudioessilva.eu/2020/05/20/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools/"><meta property="og:site_name" content="Cláudio Silva's Blog"><meta property="og:description" content="Few days ago I was surfing on Twitter when dbatools asked about how it&rsquo;s PowerShell module changed the way people work .
Open and check the answers given by the community as there is really good stuff there!
My turn I have shared one of my recipes related to database refreshes. You know, when the client says, &ldquo;please restore this backup or the most recent backup on our instance.&rdquo;. But what if the databases belong to an availability group?"><meta name=twitter:description content="Few days ago I was surfing on Twitter when dbatools asked about how it&rsquo;s PowerShell module changed the way people work .
Open and check the answers given by the community as there is really good stuff there!
My turn I have shared one of my recipes related to database refreshes. You know, when the client says, &ldquo;please restore this backup or the most recent backup on our instance.&rdquo;. But what if the databases belong to an availability group?"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2020-05-20T00:00:00"><meta property="article:modified_time" content="2020-05-20T00:00:00"><meta property="article:tag" content="Automation"><meta property="article:tag" content="Availability Groups"><meta property="article:tag" content="Database Refresh"><meta property="article:tag" content="dbatools"><meta property="article:tag" content="PowerShell"><meta property="article:tag" content="recipes"><meta property="article:tag" content="Scripting"><meta property="article:tag" content="SQLServer"><meta property="article:tag" content="syndicated"><meta name=twitter:card content="summary"><meta name=twitter:site content="@claudioessilva"><meta name=twitter:creator content="@claudioessilva"><meta property="og:image" content="https://claudioessilva.eu/img/avatar.jpg"><meta property="twitter:image" content="https://claudioessilva.eu/img/avatar.jpg"><title>Refresh databases that belongs to Availability Group using dbatools</title>
<link rel=icon href=https://claudioessilva.eu/img/favicon.jpg><link rel=canonical href=https://claudioessilva.eu/2020/05/20/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://claudioessilva.eu/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css></head><body><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=/ aria-label="Go to homepage">Cláudio Silva's Blog</a></div><a class=header-right-picture href=/#about aria-label="Open the link: /#about"><img class=header-picture src=https://claudioessilva.eu/img/avatar.jpg alt="Author's picture"></a></header><nav id=sidebar data-behavior=4><div class=sidebar-container><div class=sidebar-profile><a href=/#about aria-label="Read more about the author"><img class=sidebar-profile-picture src=https://claudioessilva.eu/img/avatar.jpg alt="Author's picture"></a><h4 class=sidebar-profile-name>Cláudio Silva</h4><h5 class=sidebar-profile-bio>Data Platform Architect and PowerShell lover.</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/ title=Home><i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden=true></i>
<span class=sidebar-button-desc>Home</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/tags title=Tags><i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden=true></i>
<span class=sidebar-button-desc>Tags</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/#about title=About><i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden=true></i>
<span class=sidebar-button-desc>About</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/claudioessilva target=_blank rel=noopener title=GitHub><i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden=true></i>
<span class=sidebar-button-desc>GitHub</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://twitter.com/claudioessilva target=_blank rel=noopener title=Twitter><i class="sidebar-button-icon fab fa-lg fa-twitter" aria-hidden=true></i>
<span class=sidebar-button-desc>Twitter</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://www.linkedin.com/in/claudioessilva target=_blank rel=noopener title=LinkedIn><i class="sidebar-button-icon fab fa-lg fa-linkedin" aria-hidden=true></i>
<span class=sidebar-button-desc>LinkedIn</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/index.xml title=RSS><i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden=true></i>
<span class=sidebar-button-desc>RSS</span></a></li></ul></div><div class=sidebar-container><div style=color:#ebebeb;font-size:25px;text-align:center>dbatools book</div><div style=color:#ebebeb;font-size:15px>Now available! Buy it at manning.com - 50% off with code bldbatools50</div><a href="https://www.manning.com/books/learn-dbatools-in-a-month-of-lunches?utm_source=claudioessilva&utm_medium=affiliate&utm_campaign=affiliate&a_aid=claudioessilva" target=_blank><center><img src=https://images.manning.com/264/352/resize/book/0/998b76f-982a-4661-a020-5d94909f7ea5/LeMaire-HI.png height=300></center></a></div></nav><div id=main data-behavior=4 class=hasCoverMetaIn><article class=post id=top><div class="post-header main-content-wrap text-left"><h1 class=post-title>Refresh databases that belongs to Availability Group using dbatools</h1><div class="postShorten-meta post-meta"><time datetime=2020-05-20T00:00:00Z>May 20, 2020</time></div></div><div class="post-content markdown"><div class=main-content-wrap><p>Few days ago I was surfing on Twitter when <a href=https://twitter.com/psdbatools target=_blank rel="noopener noreferrer">dbatools
</a>asked about <a href=https://twitter.com/psdbatools/status/1261563168113012736 target=_blank rel="noopener noreferrer">how it&rsquo;s PowerShell module changed the way people work
</a>.</p><p>Open and check the answers given by the community as there is really good stuff there!</p><h2 id=my-turn>My turn</h2><p>I have shared one of my recipes related to database refreshes. You know, when the client says, &ldquo;please restore this backup or the most recent backup on our instance.&rdquo;. But what if the databases belong to an availability group? It&rsquo;s not as simple as a standalone installation.</p><p>Seconds later, John McCormack (<a href=https://johnmccormack.it/ target=_blank rel="noopener noreferrer">
B
</a>| <a href=https://twitter.com/actualjohn target=_blank rel="noopener noreferrer">T
</a>) asked if <a href=https://twitter.com/actualjohn/status/1261605078013747200 target=_blank rel="noopener noreferrer">I have blogged about this
</a>The truth is that this blog post was already on the queue, so without further ado, I will share the script I normally use.</p><h2 id=not-so-fast---a-couple-of-notes>Not so fast - A couple of notes</h2><ul><li>Read carefully what each command does as you normally do for every single script you use from the internet. You do that, right? :-)</li><li>I have used multiple times but always only on Availability Groups with 2 nodes.</li><li>It&rsquo;s written to use automatic seeding.</li><li>You can, and you should, run the script command by command in your first try as this will be much easier to understand how it&rsquo;s working.</li></ul><h3 id=variations-that-you-may-need>Variations that you may need</h3><ul><li>With some changes you can put it to work with Availability Groups with more than 2 nodes. The failover and the set dbowner part is the one that is being done just having 2 nodes in mind.</li><li>If you have huge databases and automatic seeding is not an option for you, you may want to leverage on the backup/restore process. Take a look on the <a href=https://docs.dbatools.io/#Add-DbaAgDatabase target=_blank rel="noopener noreferrer">Add-DbaAgDatabase
</a>command docs (look to <code>-SharedPath</code> parameter along with <code>-SeedingMode Manual</code>)</li></ul><h2 id=the-script>The script</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e>&lt;#
</span></span></span><span style=display:flex><span><span style=color:#75715e>Author: Cláudio Silva
</span></span></span><span style=display:flex><span><span style=color:#75715e>Blog: https://claudioessilva.eu
</span></span></span><span style=display:flex><span><span style=color:#75715e>Twitter: https://twitter.com/claudioessilva
</span></span></span><span style=display:flex><span><span style=color:#75715e>Date: 2020/05/19
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>.</span><span style=color:#e6db74>SYNOPSIS</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    The goal of this script is to provide an automatic way to refresh one or more databases that belongs to an Availability Group.
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>.</span><span style=color:#e6db74>Description</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    The script is doing the following major steps
</span></span></span><span style=display:flex><span><span style=color:#75715e>         1 - Get the replicas (Primary and Secondary)
</span></span></span><span style=display:flex><span><span style=color:#75715e>         2 - Export user permissions of the current databases (before dropping them)
</span></span></span><span style=display:flex><span><span style=color:#75715e>         3 - Remove databases from the Availability Group (on primary node)
</span></span></span><span style=display:flex><span><span style=color:#75715e>         4 - Restore the backups with overwrite
</span></span></span><span style=display:flex><span><span style=color:#75715e>            NOTE: Here I left two options:
</span></span></span><span style=display:flex><span><span style=color:#75715e>                - one (the commented) is when the databases on the destination instance have the same name as the origin
</span></span></span><span style=display:flex><span><span style=color:#75715e>                - The 2nd one that will be running assumes that you will need to give a different name to the database on the destination instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e>                  (Example: Database called &#39;carrots&#39; is &#39;carrots_PROD&#39; on destination instance)
</span></span></span><span style=display:flex><span><span style=color:#75715e>         5 - Run the script exported on step 2
</span></span></span><span style=display:flex><span><span style=color:#75715e>         6 - Repair orphaned users
</span></span></span><span style=display:flex><span><span style=color:#75715e>         7 - Remove orphaned users
</span></span></span><span style=display:flex><span><span style=color:#75715e>         8 - Remove databases from the secondary node
</span></span></span><span style=display:flex><span><span style=color:#75715e>         9 - Add the restored databases to the availability group using Automatic Seeding
</span></span></span><span style=display:flex><span><span style=color:#75715e>        10 - Set the dbowner of the databases
</span></span></span><span style=display:flex><span><span style=color:#75715e>        11 - Test failover
</span></span></span><span style=display:flex><span><span style=color:#75715e>        12 - Set the dbowner of the databases on this node
</span></span></span><span style=display:flex><span><span style=color:#75715e>        13 - Test failback
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$listenerName = <span style=color:#e6db74>&#34;listener&#34;</span>
</span></span><span style=display:flex><span>$availabilityGroupName = <span style=color:#e6db74>&#34;AGName&#34;</span>
</span></span><span style=display:flex><span>$databases = <span style=color:#e6db74>&#34;db1&#34;</span>, <span style=color:#e6db74>&#34;db2&#34;</span> <span style=color:#75715e># Add more if you need. Also if using the 2nd method of restore, add there too.</span>
</span></span><span style=display:flex><span>$dboLogin = <span style=color:#e6db74>&#34;dbOwnerLogin&#34;</span>
</span></span><span style=display:flex><span>$exportUserPath = <span style=color:#e6db74>&#34;&lt;Path&gt;\Exported_Users_</span>$availabilityGroupName<span style=color:#e6db74>.sql&#34;</span>
</span></span><span style=display:flex><span>$DestinationDataDirectory = <span style=color:#e6db74>&#34;&lt;pathToYourDataDirectory&#34;</span>
</span></span><span style=display:flex><span>$DestinationLogDirectory = <span style=color:#e6db74>&#34;&lt;pathToYourLogDirectory&#34;</span>
</span></span><span style=display:flex><span>$backupDirectory = <span style=color:#e6db74>&#34;&lt;pathToYourBackups&gt;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Get AG replicas</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$agReplicas = Get-DbaAgReplica -SqlInstance $listenerName -AvailabilityGroup $availabilityGroupName
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Get current primary node</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$primaryNode = ($agReplicas | Where-Object role <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;Primary&#39;</span>).Name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Get secondary node</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$secondaryNode = ($agReplicas | Where-Object role <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;Secondary&#39;</span>).Name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Export users permissions</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Export-DbaUser -SqlInstance $primaryNode -Database $databases -Path $exportUserPath
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remove the databses from the AG</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Remove-DbaAgDatabase -SqlInstance $primaryNode -AvailabilityGroup $availabilityGroupName -Database $databases <span style=color:#75715e>#-Confirm:$false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Restore databases with overwrite</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Restore databases with overwrite</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1 - You can get all backups from a folder pipe to Restore-DbaDatabase and it will do the magic.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Restore databases with overwrite</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1 - You can get all backups from a folder pipe to Restore-DbaDatabase and it will do the magic.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Get-ChildItem -Path $backupDirectory -Recurse -Filter &#34;*.bak&#34; | Restore-DbaDatabase -SqlInstance $sqlinstance -WithReplace -DestinationDataDirectory $DestinationDataDirectory -DestinationLogDirectory $DestinationLogDirectory</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2 - If you need to restore the database with a different name, you may prefer to specify each -Database name from the specific backup</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># NOTE: This will keep the database name.</span>
</span></span><span style=display:flex><span>Restore-DbaDatabase -SqlInstance $primaryNode -DatabaseName <span style=color:#e6db74>&#39;db1&#39;</span> -Path <span style=color:#e6db74>&#34;</span>$backupDirectory<span style=color:#e6db74>\db1.bak&#34;</span> -WithReplace -DestinationDataDirectory $DestinationDataDirectory -DestinationLogDirectory $DestinationLogDirectory
</span></span><span style=display:flex><span>Restore-DbaDatabase -SqlInstance $primaryNode -DatabaseName <span style=color:#e6db74>&#39;db2&#39;</span> -Path <span style=color:#e6db74>&#34;</span>$backupDirectory<span style=color:#e6db74>\db2.bak&#34;</span> -WithReplace -DestinationDataDirectory $DestinationDataDirectory -DestinationLogDirectory $DestinationLogDirectory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Put the permissions back</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Put the permissions back</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Note: We need to replace the &#39;GO&#39; batch separator as Invoke-DbaQuery will do this split and send execution one-by-one. This means that a database context change works but then next command will probably be run on master</span>
</span></span><span style=display:flex><span>Invoke-DbaQuery -SqlInstance $primaryNode -Query $((Get-Content $exportUserPath) <span style=color:#f92672>-replace</span> <span style=color:#e6db74>&#39;\bGO\b&#39;</span>, <span style=color:#e6db74>&#39; &#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Repair Orphan Users</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Repair-DbaDbOrphanUser -SqlInstance $primaryNode -Database $databases
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remove Orphan Users</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Remove-DbaDbOrphanUser -SqlInstance $primaryNode -Database $database
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remove databases from the secondary instance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Remove-DbaDatabase -SqlInstance $secondaryNode -Database $databases <span style=color:#75715e>#-Confirm:$false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Add databases to the AG using &#39;Automatic&#39; option for -SeedingMode parameter</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Add-DbaAgDatabase -SqlInstance $primaryNode -AvailabilityGroup $availabilityGroupName -Database $databases -SeedingMode Automatic <span style=color:#75715e>#-Confirm:$false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Change database owner on the primary</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Set-DbaDbOwner -SqlInstance $primaryNode -Database $databases -TargetLogin $dboLogin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Failover the AG so we can set database DB</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Invoke-DbaAgFailover -SqlInstance $secondaryNode -AvailabilityGroup $availabilityGroupName
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Change database owner</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Set-DbaDbOwner -SqlInstance $secondaryNode -Database $databases -TargetLogin $dboLogin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Failover back if wanted/needed</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Invoke-DbaAgFailover -SqlInstance $primaryNode -AvailabilityGroup $availabilityGroupName
</span></span></code></pre></div><h3 id=what-do-you-need-to-change>What do you need to change</h3><p>1 - Fill the variable values from lines 27 to 34.
2 - Select your method of restore / seeding. Lines 51 to 59.</p><h2 id=same-task-but-not-for-databases-within-availability-groups>Same task but not for databases within Availability Groups</h2><p>With this script as a starting point you can adapt to do refreshes of databases that work on single instances.</p><h2 id=wrap-up>Wrap up</h2><p>I hope you find it useful.
As a time metric I can tell you that (excluding restores/seeding) all the other actions took me about 15min to run manually with a lot of possible things to go wrong. Now it takes me 5min or less.</p><p>If you are facing difficulties, drop a comment.</p><p>Thanks for reading!</p></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">TAGGED IN</span><br><a class="tag tag--primary tag--small" href=/tags/Automation/>Automation</a>
<a class="tag tag--primary tag--small" href=/tags/Availability-Groups/>Availability Groups</a>
<a class="tag tag--primary tag--small" href=/tags/Database-Refresh/>Database Refresh</a>
<a class="tag tag--primary tag--small" href=/tags/dbatools/>dbatools</a>
<a class="tag tag--primary tag--small" href=/tags/PowerShell/>PowerShell</a>
<a class="tag tag--primary tag--small" href=/tags/recipes/>recipes</a>
<a class="tag tag--primary tag--small" href=/tags/Scripting/>Scripting</a>
<a class="tag tag--primary tag--small" href=/tags/SQLServer/>SQLServer</a>
<a class="tag tag--primary tag--small" href=/tags/syndicated/>syndicated</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2020/05/25/Export-Deadlocks-to-file-from-system_health-Extended-Event-using-PowerShell/ data-tooltip="Export Deadlocks to file from system_health Extended Event using PowerShell" aria-label="NEXT: Export Deadlocks to file from system_health Extended Event using PowerShell"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2020/02/21/T-SQL-Copy-Paste-Pattern-Increasing-a-performance-problem/ data-tooltip="T-SQL Copy & Paste Pattern - Increasing a performance problem" aria-label="PREVIOUS: T-SQL Copy & Paste Pattern - Increasing a performance problem"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://claudioessilva.eu/2020/05/20/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools/" title="Share on Facebook" aria-label="Share on Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://claudioessilva.eu/2020/05/20/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools/" title="Share on Twitter" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://claudioessilva.eu/2020/05/20/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools/" title="Share on Linkedin" aria-label="Share on Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label="Back to top"><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div><div class=comments><script src=https://utteranc.es/client.js repo=ClaudioESSilva/blog-comments issue-term=og:title theme=github-light crossorigin=anonymous async></script></div></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2024 Cláudio Silva. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2020/05/25/Export-Deadlocks-to-file-from-system_health-Extended-Event-using-PowerShell/ data-tooltip="Export Deadlocks to file from system_health Extended Event using PowerShell" aria-label="NEXT: Export Deadlocks to file from system_health Extended Event using PowerShell"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2020/02/21/T-SQL-Copy-Paste-Pattern-Increasing-a-performance-problem/ data-tooltip="T-SQL Copy & Paste Pattern - Increasing a performance problem" aria-label="PREVIOUS: T-SQL Copy & Paste Pattern - Increasing a performance problem"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://claudioessilva.eu/2020/05/20/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools/" title="Share on Facebook" aria-label="Share on Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://claudioessilva.eu/2020/05/20/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools/" title="Share on Twitter" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://claudioessilva.eu/2020/05/20/Refresh-databases-that-belongs-to-Availability-Group-using-dbatools/" title="Share on Linkedin" aria-label="Share on Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label="Back to top"><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div><div id=share-options-bar class=share-options-bar data-behavior=4><i id=btn-close-shareoptions class="fa fa-times"></i><ul class=share-options><li class=share-option><a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fclaudioessilva.eu%2F2020%2F05%2F20%2FRefresh-databases-that-belongs-to-Availability-Group-using-dbatools%2F" aria-label="Share on Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i><span>Share on Facebook</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fclaudioessilva.eu%2F2020%2F05%2F20%2FRefresh-databases-that-belongs-to-Availability-Group-using-dbatools%2F" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden=true></i><span>Share on Twitter</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fclaudioessilva.eu%2F2020%2F05%2F20%2FRefresh-databases-that-belongs-to-Availability-Group-using-dbatools%2F" aria-label="Share on Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i><span>Share on Linkedin</span></a></li></ul></div><div id=share-options-mask class=share-options-mask></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-times"></i></div><img id=about-card-picture src=https://claudioessilva.eu/img/avatar.jpg alt="Author's picture"><h4 id=about-card-name>Cláudio Silva</h4><div id=about-card-bio>Data Platform Architect and PowerShell lover.</div><div id=about-card-job><i class="fa fa-briefcase"></i><br>Data Platform Architect</div><div id=about-card-location><i class="fa fa-map-marker-alt"></i><br>Portugal</div></div></div><div id=cover style=background-image:url(https://claudioessilva.eu/images/cover_bridge.jpg)></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://claudioessilva.eu/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js></script><script>$(document).ready(function(){hljs.configure({classPrefix:"",useBR:!1}),$("pre.code-highlight > code, pre > code").each(function(e,t){$(this).hasClass("codeblock")||$(this).addClass("codeblock"),hljs.highlightBlock(t)})})</script></body></html>